# Часто задаваемые вопросы (FAQ)

Ответы на распространенные вопросы о TG-RSS боте.

## Оглавление

- [Общие вопросы](#общие-вопросы)
- [Установка и настройка](#установка-и-настройка)
- [Использование бота](#использование-бота)
- [RSS источники](#rss-источники)
- [Производительность](#производительность)
- [Безопасность](#безопасность)
- [Разработка](#разработка)

## Общие вопросы

### Что такое TG-RSS?

TG-RSS — это Telegram бот для агрегации и автоматической доставки новостей из RSS-лент. Бот опрашивает RSS источники, обрабатывает новости и отправляет уведомления подписанным пользователям.

### Какие основные возможности?

- Подписка на 33+ новостных источников
- Автоматические уведомления о новых новостях
- Интерактивное управление через inline-кнопки
- Аналитический модуль "Карта дня" с ML-анализом
- Оптимизация для серверов с ограниченными ресурсами (1.2GB RAM)
- REST API для управления

### Какие требования к серверу?

**Минимальные**:
- 1.2 GB RAM
- 1 CPU core
- 10 GB дискового пространства
- Ubuntu 20.04+ / Debian 11+

**Рекомендуемые**:
- 2 GB RAM
- 2 CPU cores
- 20 GB SSD

### Какая лицензия?

Проект распространяется под MIT лицензией. Вы можете свободно использовать, изменять и распространять код.

### Сколько стоит запуск?

Бот полностью бесплатен и open-source. Вам потребуется только:
- VPS сервер (~$5-10/месяц для минимальных требований)
- Telegram Bot токен (бесплатно)

## Установка и настройка

### Как получить Telegram Bot токен?

1. Найдите [@BotFather](https://t.me/BotFather) в Telegram
2. Отправьте команду `/newbot`
3. Следуйте инструкциям (выберите имя и username)
4. Скопируйте полученный токен
5. Добавьте токен в `.env` файл:
   ```
   TELEGRAM_API_KEY=123456789:ABCdefGHIjklMNOpqrsTUVwxyz
   ```

### Как установить бота?

Три способа:

**1. Docker Compose (рекомендуется)**:
```bash
git clone https://github.com/yourusername/tg-rss.git
cd tg-rss
cp .env.example .env
# Отредактировать .env
docker-compose up -d
```

**2. Ansible (production)**:
```bash
cd ansible
ansible-playbook -i inventory/production/hosts playbooks/server-setup.yml
```

**3. Вручную (разработка)**:
```bash
go build -o news-bot
./news-bot
```

Подробнее: [DEPLOYMENT.md](DEPLOYMENT.md)

### Нужна ли регистрация БД?

Нет, БД создается автоматически при первом запуске. Все миграции применяются через `InitSchema()` в `db/db.go`.

### Как изменить порт API?

Измените порт в `main.go`:
```go
server := &http.Server{
    Addr:    ":8080",  // Измените на нужный
    Handler: mux,
}
```

Или через docker-compose.yml:
```yaml
ports:
  - "9090:8080"  # Внешний:Внутренний
```

### Можно ли запустить без Redis?

Да! Бот автоматически переходит в режим "graceful degradation" если Redis недоступен. Функциональность сохраняется, но без асинхронной обработки через очереди.

### Как настроить мониторинг?

Мониторинг уже встроен:

1. **Prometheus + Grafana** (рекомендуется):
   ```bash
   docker-compose --profile monitoring up -d
   ```
   - Grafana: http://localhost:3000 (admin/admin)
   - Prometheus: http://localhost:9090

2. **Базовый мониторинг**:
   - Health: http://localhost:8080/health
   - Metrics: http://localhost:8080/metrics

Подробнее: [docs/monitoring-setup.md](docs/monitoring-setup.md)

## Использование бота

### Какие команды поддерживает бот?

Основные команды:
- `/start` — запуск бота и регистрация
- `/subscribe` — подписка на источники
- `/unsubscribe` — отписка от источников
- `/list` — список ваших подписок
- `/sources` — все доступные источники
- `/help` — справка

### Как добавить нового пользователя?

Пользователи регистрируются автоматически при отправке `/start` боту. Никаких дополнительных действий не требуется.

### Как часто приходят новости?

Новости проверяются каждые 60 секунд по умолчанию (настраивается через `TIMEOUT` в `.env`). Отправка пользователям происходит батчами каждые 15 минут для оптимизации rate limits.

### Можно ли получать новости сразу?

Нет встроенной опции для мгновенной доставки из-за ограничений Telegram API (30 сообщений/секунду). Минимальный интервал проверки — 30 секунд.

### Что такое "Карта дня"?

Аналитический модуль на Python, который:
- Собирает новости за период
- Анализирует и группирует по темам (ML кластеризация)
- Генерирует сводный отчет
- Отправляет автоматически 5 раз в день

Настройка: `news-analyzer-python/config.py`

### Как отключить "Карту дня"?

Отключите сервис в docker-compose.yml:
```yaml
# Закомментируйте секцию
# news-analyzer:
#   build: ./news-analyzer-python
#   ...
```

### Есть ли лимит на количество подписок?

Нет жестких лимитов. Рекомендуется не более 50 подписок на пользователя для оптимальной производительности.

## RSS источники

### Какие источники поддерживаются?

33 предустановленных российских новостных источника. Полный список в `db/db.go:InitDefaultSources()`.

Категории:
- Мировые новости
- Технологии
- Финансы  
- Спорт
- И другие

### Как добавить свой RSS источник?

**Через API**:
```bash
curl -X POST "http://localhost:8080/api/v1/sources/create" \
  -H "Content-Type: application/json" \
  -d '{"name": "Мой источник", "url": "https://example.com/feed.xml"}'
```

**Через БД**:
```sql
INSERT INTO sources (name, url, status) 
VALUES ('Мой источник', 'https://example.com/feed.xml', 'active');
```

**Требования к URL**:
- Только HTTP/HTTPS
- Не localhost/приватные IP
- Максимум 2048 символов

### Можно ли отключить источник?

Да, через API:
```bash
curl -X DELETE "http://localhost:8080/api/v1/sources/delete?id=1"
```

Или в БД:
```sql
UPDATE sources SET status='inactive' WHERE id=1;
```

### Почему некоторые источники не работают?

Возможные причины:
1. Источник временно недоступен — circuit breaker автоматически повторит
2. Изменился URL — обновите через API
3. Невалидный RSS формат — проверьте через валидатор
4. Блокировка по IP — используйте VPN/прокси

### Как часто обновляются RSS источники?

По умолчанию каждые 60 секунд. Настраивается в `.env`:
```
TIMEOUT=60  # секунды между проверками
```

Рекомендуемые значения: 30-300 секунд.

## Производительность

### Сколько новостей может обработать бот?

Реальные показатели на VPS (1.2GB RAM, 1 CPU):
- ~1000 новостей/час
- ~50 активных пользователей
- ~30 RSS источников
- Использование памяти: 150-200 MB

При масштабировании (2GB RAM, 2 CPU):
- ~5000 новостей/час
- ~200 активных пользователей

### Как оптимизировать производительность?

1. **Включить Redis** для асинхронной обработки
2. **Настроить параллелизм**:
   ```
   CONTENT_SCRAPER_CONCURRENT=3  # Параллельные запросы
   CONTENT_SCRAPER_BATCH=50      # Размер батча
   ```
3. **Увеличить интервалы**:
   ```
   TIMEOUT=120                   # Реже проверять RSS
   CONTENT_SCRAPER_INTERVAL=5    # Реже скрапить контент
   ```
4. **Мониторить метрики**:
   ```bash
   curl http://localhost:8080/metrics
   ```

### Почему бот медленно отправляет новости?

Это нормально из-за:
1. **Rate limiting** Telegram API (30 сообщений/секунду)
2. **Адаптивный rate limiter** — автоматически снижает скорость при ошибках
3. **Батчевая отправка** — каждые 15 минут для оптимизации

Для ускорения уменьшите интервал в `bot/news_processor.go:DefaultSendInterval`.

### Растет потребление памяти

Проверьте:
1. **Утечки памяти** — уже исправлены в последней версии (периодическая очистка)
2. **Размер очередей**:
   ```bash
   curl http://localhost:8080/metrics | grep pending
   ```
3. **Лимиты Docker**:
   ```yaml
   deploy:
     resources:
       limits:
         memory: 512M
   ```

## Безопасность

### Безопасно ли хранить токен в .env?

Для production рекомендуется:
1. Использовать Ansible Vault для секретов
2. Установить права доступа:
   ```bash
   chmod 600 .env
   ```
3. Добавить `.env` в `.gitignore`
4. Использовать переменные окружения системы

### Как защитить API endpoints?

API защищен через:
1. **Rate limiting** (100 req/min на IP)
2. **CORS** ограничен localhost для dev
3. **Валидация** всех входных данных
4. **Защита от injection** (SQL, command)

Для production добавьте:
- Nginx reverse proxy с HTTPS
- API ключи/токены
- IP whitelist

### Можно ли разместить на публичном сервере?

Да, но рекомендуется:
1. Настроить firewall:
   ```bash
   sudo ufw allow 22/tcp   # SSH
   sudo ufw allow 80/tcp   # HTTP
   sudo ufw allow 443/tcp  # HTTPS
   sudo ufw enable
   ```
2. Использовать HTTPS (Let's Encrypt)
3. Регулярно обновлять зависимости
4. Мониторить логи безопасности

### Как обновить зависимости?

Зависимости обновляются автоматически через Dependabot. Вручную:

```bash
# Go модули
go get -u ./...
go mod tidy

# Python
pip install --upgrade -r requirements.txt

# Docker образы
docker-compose pull
docker-compose build --no-cache
```

## Разработка

### Как запустить в режиме разработки?

```bash
# Установить зависимости
go mod download

# Запустить БД и Redis
docker-compose up -d tg-rss-db tg-rss-redis

# Запустить бота локально
go run main.go
```

### Как добавить новую функцию?

1. Создайте feature branch:
   ```bash
   git checkout -b feat/my-feature
   ```

2. Внесите изменения согласно:
   - `.cursor/AGENTS.md` — общие правила
   - `COMMIT_CONVENTION.md` — формат коммитов
   - Clean Architecture принципам

3. Добавьте тесты:
   ```bash
   go test ./...
   ```

4. Создайте Pull Request

Подробнее: [CONTRIBUTING.md](CONTRIBUTING.md)

### Как запустить тесты?

```bash
# Все тесты
go test ./...

# С покрытием
go test -cover ./...

# Конкретный пакет
go test ./api/...

# С race detector
go test -race ./...
```

Подробнее: [TESTING.md](TESTING.md)

### Где найти документацию API?

- OpenAPI спецификация: http://localhost:8080/openapi.yaml
- Детальная документация: [docs/openapi.yaml](docs/openapi.yaml)
- Postman коллекция: в разработке

### Как работает CI/CD?

GitHub Actions workflows:
- `go.yml` — тестирование, линтинг, безопасность
- `ci-cd.yml` — сборка Docker образов, деплой
- `security.yml` — сканирование безопасности (ежедневно)

Все проверки автоматические при push/PR.

### Можно ли внести вклад в проект?

Да! Приветствуем контрибьюции:
1. Fork репозитория
2. Создайте feature branch
3. Внесите изменения с тестами
4. Создайте Pull Request

См. [CONTRIBUTING.md](CONTRIBUTING.md) для деталей.

## Дополнительные вопросы

### Не нашли ответ?

1. Проверьте [TROUBLESHOOTING.md](TROUBLESHOOTING.md)
2. Поищите в [Issues](https://github.com/yourusername/tg-rss/issues)
3. Создайте новый Issue
4. Напишите: support@example.com

### Где найти больше документации?

- [README.md](README.md) — обзор проекта
- [DEPLOYMENT.md](DEPLOYMENT.md) — развертывание
- [TESTING.md](TESTING.md) — тестирование
- [docs/](docs/) — детальная документация
- [.cursor/](. cursor/) — правила разработки
