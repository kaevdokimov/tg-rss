# Конвенция коммитов

Проект использует Conventional Commits с **обязательным русским языком** для всех текстов.

## Формат

```
тип(область): краткое описание

[необязательное подробное описание]

[необязательные ссылки на задачи]
```

## Правила

### Заголовок коммита

1. **МАКСИМУМ 72 СИМВОЛА** (строго!)
2. **Русский язык** - обязательно, английские буквы допустимы только для технических терминов
3. Начинается с **маленькой буквы**
4. **Не заканчивается точкой**
5. Пишется в **повелительном наклонении** (что сделано)

### Типы коммитов

| Тип | Описание | Пример |
|-----|----------|--------|
| `feat` | Новая функциональность | `feat(bot): добавить inline-кнопки` |
| `fix` | Исправление бага | `fix(db): устранить утечку памяти` |
| `perf` | Оптимизация производительности | `perf(cache): ускорить поиск` |
| `refactor` | Рефакторинг без изменения API | `refactor(api): упростить обработку` |
| `style` | Форматирование кода | `style(bot): исправить отступы` |
| `test` | Добавление/исправление тестов | `test(scraper): покрыть очистку null-байтов` |
| `docs` | Документация | `docs(readme): дополнить установку` |
| `build` | Сборка и зависимости | `build(deps): обновить go-telegram` |
| `ci` | CI/CD изменения | `ci(workflow): добавить кэширование` |
| `chore` | Прочие изменения | `chore(config): обновить настройки` |

### Области (scope)

Основные области проекта:

- `bot` - Telegram бот
- `api` - REST API
- `db` - База данных
- `redis` - Redis и кэширование
- `rss` - RSS парсинг
- `scraper` - Веб-скрапинг
- `monitoring` - Мониторинг и логирование
- `config` - Конфигурация
- `middleware` - HTTP middleware
- `cache` - In-memory кэш
- `security` / `sec` - Безопасность
- `workflow` / `wf` - GitHub Actions
- `infra` - Инфраструктура (Ansible, Docker)
- `docs` - Документация

## Примеры правильных коммитов

### Отличные примеры (≤ 72 символа)

```
feat(bot): добавить inline-кнопки для управления подписками
fix(db): устранить утечку памяти в connection pool
perf(cache): ускорить поиск дубликатов новостей
refactor(api): упростить валидацию входных данных
test(scraper): покрыть очистку null-байтов тестами
docs(readme): дополнить инструкцию по установке
ci(workflow): добавить кэширование Go модулей
chore(config): обновить настройки безопасности
```

### С подробным описанием

```
feat(bot): добавить аналитический модуль "Карта дня"

Реализован ML-анализ новостей:
- Векторизация текста через TF-IDF
- Кластеризация через HDBSCAN
- Автоматическая генерация нарративов
- Отправка отчетов 5 раз в день

Связано: #42, #43
```

### Breaking changes

```
feat(api)!: изменить формат ответов API на JSON:API

BREAKING CHANGE: формат ответов теперь соответствует JSON:API спецификации.
Старые клиенты должны обновить обработку ответов.
```

## Приемы сокращения длинных сообщений

### Используйте аббревиатуры

- `workflow` → `wf`
- `configuration` → `config`
- `security` → `sec`
- `repository` → `repo`
- `database` → `db`

### Избегайте многословия

❌ **Плохо** (76 символов):
```
feat(workflow): обновить настройки прав доступа для управления защитой веток
```

✅ **Хорошо** (55 символов):
```
feat(workflow): настроить права доступа для защиты веток
```

### Убирайте лишние слова

❌ **Плохо**:
```
fix(security): исправить ошибку в обработке контейнеров
```

✅ **Хорошо**:
```
fix(sec): исправить сканирование контейнеров
```

### Используйте конкретные глаголы

| Вместо | Используйте |
|--------|-------------|
| добавить поддержку для | добавить поддержку |
| исправить ошибку в | исправить |
| обновить настройки | настроить / обновить |
| добавить возможность | добавить / реализовать |

## Запрещено

❌ **Неправильные примеры:**

```
Fix bug                                    # Английский язык
Добавить новую фичу.                       # Точка в конце
Обновление документации                    # Начинается с заглавной
feat: добавить что-то                      # Нет области
feat(api): добавить очень длинное описание того что мы сделали в этом коммите # >72 символов
```

## Проверка

Проект использует git hooks для автоматической проверки формата коммитов.

При нарушении формата коммит будет отклонен с подсказкой.

## Полезные команды

Проверить длину сообщения:
```bash
echo "ваш заголовок" | wc -c
```

Просмотреть последние коммиты:
```bash
git log --oneline -10
```

Исправить последний коммит:
```bash
git commit --amend
```

## Дополнительные ресурсы

- [Conventional Commits](https://www.conventionalcommits.org/)
- [Semantic Versioning](https://semver.org/)
- [Effective Commit Messages](https://chris.beams.io/posts/git-commit/)
