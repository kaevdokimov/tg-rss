# Настройка GitHub Actions для отправки отчетов

## Настройка секретов

Для работы отправки отчетов в Telegram необходимо настроить секрет в GitHub Actions:

### Шаг 1: Создание бота

1. Откройте Telegram и найдите @BotFather
2. Отправьте команду `/newbot`
3. Следуйте инструкциям для создания бота
4. Сохраните полученный токен

### Шаг 2: Добавление секрета в GitHub

1. Перейдите в ваш репозиторий на GitHub
2. Откройте **Settings** → **Secrets and variables** → **Actions**
3. Нажмите **New repository secret**
4. Добавьте секрет:
   - **Name**: `TELEGRAM_SIGNAL_API_KEY`
   - **Secret**: токен вашего бота для отчетов
5. Нажмите **Add secret**

### Шаг 3: Проверка

После деплоя проверьте, что переменная передается в контейнер:

```bash
# На сервере
docker exec -it news-analyzer env | grep TELEGRAM_SIGNAL_API_KEY
```

Должен отображаться токен бота.

## Структура секретов

В GitHub Actions должны быть настроены следующие секреты:

- `TELEGRAM_API_KEY` - токен основного бота (для работы RSS-бота)
- `TELEGRAM_SIGNAL_API_KEY` - токен бота для отправки отчетов анализа (отдельный бот)

## Автоматическая передача в .env

При деплое через GitHub Actions токен автоматически добавляется в `.env` файл:

```env
TELEGRAM_SIGNAL_API_KEY=<токен из secrets>
```

И передается в docker-compose через переменные окружения.

## Важные замечания

1. **Отдельный бот**: Используется отдельный бот от основного, чтобы не мешать работе RSS-бота
2. **Пользователи должны написать боту**: Пользователи должны сначала написать боту `/start`, чтобы бот мог им отправлять сообщения
3. **Безопасность**: Токен хранится в GitHub Secrets и не попадает в код

## Устранение проблем

### Секрет не передается в контейнер

1. Проверьте, что секрет добавлен в GitHub Actions secrets
2. Проверьте, что имя секрета точно `TELEGRAM_SIGNAL_API_KEY` (с учетом регистра)
3. Проверьте логи деплоя в GitHub Actions

### Бот не отправляет сообщения

1. Убедитесь, что пользователи написали боту `/start`
2. Проверьте логи: `make analyzer-logs | grep -i telegram`
3. Проверьте, что токен правильный (можно проверить через @BotFather)
