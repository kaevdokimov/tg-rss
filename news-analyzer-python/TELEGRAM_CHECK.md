# –ü—Ä–æ–≤–µ—Ä–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram –±–æ—Ç–∞

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞

### 1. –ò–º–ø–æ—Ä—Ç—ã
- ‚úÖ `os` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –≤ `run_daily.py`
- ‚úÖ `Database`, `User` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã –∏–∑ `src.db`
- ‚úÖ `TelegramNotifier` –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω –∏–∑ `src.reporter`
- ‚úÖ `Path` –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è `report_path`

### 2. –õ–æ–≥–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏ (run_daily.py, —Å—Ç—Ä–æ–∫–∏ 162-197)

```python
# 6. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–∞ –≤ Telegram –≤—Å–µ–º –ø–æ–¥–ø–∏—Å–∞–Ω–Ω—ã–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
telegram_token = os.getenv("TELEGRAM_SIGNAL_API_KEY")

if telegram_token:
    try:
        logger.info("–ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –∏–∑ –ë–î...")
        users = db.get_all_users()  # ‚úÖ –ú–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        
        if not users:
            logger.warning("–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏ –Ω–µ –Ω–∞–π–¥–µ–Ω—ã –≤ –ë–î. –û—Ç—á–µ—Ç –Ω–µ –±—É–¥–µ—Ç –æ—Ç–ø—Ä–∞–≤–ª–µ–Ω.")
        else:
            logger.info(f"–ù–∞–π–¥–µ–Ω–æ {len(users)} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π. –û—Ç–ø—Ä–∞–≤–∫–∞ –æ—Ç—á–µ—Ç–æ–≤...")
            
            # –°–æ–∑–¥–∞–µ–º notifier
            notifier = TelegramNotifier(bot_token=telegram_token)  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
            
            # –ü–æ–ª—É—á–∞–µ–º —Å–ø–∏—Å–æ–∫ chat_id
            chat_ids = [user.chat_id for user in users]  # ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫ –ø–æ–ª—é
            
            # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ—Ç—á–µ—Ç –≤—Å–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º
            results = notifier.send_report_to_all(chat_ids, report_path)  # ‚úÖ –ú–µ—Ç–æ–¥ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
            
            # –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –æ—Ç–ø—Ä–∞–≤–∫–∏
            successful = sum(1 for success in results.values() if success)
            failed = len(results) - successful
            
            logger.info(f"–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞: —É—Å–ø–µ—à–Ω–æ {successful}, –æ—à–∏–±–æ–∫ {failed}")
            
            if failed > 0:
                failed_chat_ids = [chat_id for chat_id, success in results.items() if not success]
                logger.warning(f"–ù–µ —É–¥–∞–ª–æ—Å—å –æ—Ç–ø—Ä–∞–≤–∏—Ç—å {failed} –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º: {failed_chat_ids[:10]}...")
    except Exception as e:
        logger.error(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –æ—Ç—á–µ—Ç–æ–≤ –≤ Telegram: {e}")
else:
    logger.info("Telegram –Ω–µ –Ω–∞—Å—Ç—Ä–æ–µ–Ω (TELEGRAM_SIGNAL_API_KEY –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)")
```

### 3. –ú–µ—Ç–æ–¥—ã Database

- ‚úÖ `get_all_users()` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ (—Å—Ç—Ä–æ–∫–∏ 167-203 –≤ database.py)
- ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç –±–µ–∑–æ–ø–∞—Å–Ω—É—é –ø–æ–¥—Å—Ç–∞–Ω–æ–≤–∫—É –∏–º–µ–Ω–∏ —Ç–∞–±–ª–∏—Ü—ã —á–µ—Ä–µ–∑ `sql.Identifier()`
- ‚úÖ –í–æ–∑–≤—Ä–∞—â–∞–µ—Ç `List[User]` —Å –ø–æ–ª—è–º–∏ `chat_id` –∏ `username`

### 4. –ú–µ—Ç–æ–¥—ã TelegramNotifier

- ‚úÖ `send_report_to_all(chat_ids: List[int], report_path: Path)` - —Å—É—â–µ—Å—Ç–≤—É–µ—Ç (—Å—Ç—Ä–æ–∫–∞ 138)
- ‚úÖ `send_message_to_all(chat_ids: List[int], text: str)` - –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏
- ‚úÖ `_format_report_message(report: Dict[str, Any])` - —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ

### 5. –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö

- ‚úÖ `report_path` - —Ç–∏–ø `Path` (–≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç—Å—è –∏–∑ `formatter.save_report()`)
- ‚úÖ `chat_ids` - —Ç–∏–ø `List[int]` (–∏–∑–≤–ª–µ–∫–∞–µ—Ç—Å—è –∏–∑ `users`)
- ‚úÖ `report_path` –ø–µ—Ä–µ–¥–∞–µ—Ç—Å—è –≤ `send_report_to_all()` –∫–æ—Ç–æ—Ä—ã–π –ø—Ä–∏–Ω–∏–º–∞–µ—Ç `Path`

## üîç –ü–æ—Ç–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

### 1. –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è **–ø–æ—Å–ª–µ** —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –≤ –ë–î, —á—Ç–æ –ø—Ä–∞–≤–∏–ª—å–Ω–æ:
1. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ JSON –æ—Ç—á–µ—Ç–∞ (—Å—Ç—Ä–æ–∫–∞ 128)
2. –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ –ë–î (—Å—Ç—Ä–æ–∫–∏ 135-149) - –≤ try/except, –Ω–µ –±–ª–æ–∫–∏—Ä—É–µ—Ç
3. –û—Ç–ø—Ä–∞–≤–∫–∞ –≤ Telegram (—Å—Ç—Ä–æ–∫–∏ 162-197)

### 2. –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

- ‚úÖ –û—à–∏–±–∫–∏ –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –≤ –ë–î –Ω–µ –±–ª–æ–∫–∏—Ä—É—é—Ç –æ—Ç–ø—Ä–∞–≤–∫—É –≤ Telegram
- ‚úÖ –û—à–∏–±–∫–∏ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ –≤ Telegram –ª–æ–≥–∏—Ä—É—é—Ç—Å—è, –Ω–æ –Ω–µ –ø—Ä–µ—Ä—ã–≤–∞—é—Ç –ø—Ä–æ—Ü–µ—Å—Å
- ‚úÖ –ï—Å–ª–∏ `TELEGRAM_SIGNAL_API_KEY` –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω, –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è —Å–æ–æ–±—â–µ–Ω–∏–µ

### 3. –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏

–í—Å–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –Ω–∞ –º–µ—Å—Ç–µ:
- ‚úÖ `os` - —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–∞—è –±–∏–±–ª–∏–æ—Ç–µ–∫–∞
- ‚úÖ `Path` - –∏–∑ `pathlib`
- ‚úÖ `Database`, `User` - –∏–∑ `src.db`
- ‚úÖ `TelegramNotifier` - –∏–∑ `src.reporter`

## ‚úÖ –í—ã–≤–æ–¥

**–ö–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –≤ Telegram –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ –∏ –Ω–µ —Å–ª–æ–º–∞–Ω.**

–í—Å–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –Ω–∞ –º–µ—Å—Ç–µ:
- ‚úÖ –ò–º–ø–æ—Ä—Ç—ã –ø—Ä–∞–≤–∏–ª—å–Ω—ã–µ
- ‚úÖ –ú–µ—Ç–æ–¥—ã —Å—É—â–µ—Å—Ç–≤—É—é—Ç –∏ —Ä–∞–±–æ—Ç–∞—é—Ç
- ‚úÖ –¢–∏–ø—ã –¥–∞–Ω–Ω—ã—Ö —Å–æ–≤–º–µ—Å—Ç–∏–º—ã
- ‚úÖ –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è
- ‚úÖ –ü–æ—Ä—è–¥–æ–∫ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π

## üß™ –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

1. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è:**
   ```bash
   docker exec -it news-analyzer env | grep TELEGRAM_SIGNAL_API_KEY
   ```

2. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –Ω–∞–ª–∏—á–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î:**
   ```bash
   docker exec -it news-analyzer python -c "
   from src.config import load_settings
   from src.db import Database
   s = load_settings()
   db = Database(s.get_db_connection_string())
   db.connect()
   users = db.get_all_users()
   print(f'–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –≤ –ë–î: {len(users)}')
   db.disconnect()
   "
   ```

3. **–†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫ –∞–Ω–∞–ª–∏–∑–∞:**
   ```bash
   docker exec -it news-analyzer python run_daily.py
   ```

4. **–ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–æ–≥–æ–≤:**
   ```bash
   docker logs news-analyzer | grep -i telegram
   ```

## üîß –ï—Å–ª–∏ –æ—Ç–ø—Ä–∞–≤–∫–∞ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ç–æ–∫–µ–Ω –±–æ—Ç–∞:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `TELEGRAM_SIGNAL_API_KEY` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –≤ `.env` –∏–ª–∏ GitHub Actions secrets
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ —Ç–æ–∫–µ–Ω –ø—Ä–∞–≤–∏–ª—å–Ω—ã–π –∏ –±–æ—Ç –∞–∫—Ç–∏–≤–µ–Ω

2. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –≤ —Ç–∞–±–ª–∏—Ü–µ `users` –µ—Å—Ç—å –∑–∞–ø–∏—Å–∏
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `chat_id` –∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–µ

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ —Ñ–∞–π–ª –æ—Ç—á–µ—Ç–∞:**
   - –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ `report_path` —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –∏ –¥–æ—Å—Ç—É–ø–µ–Ω
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–∞–π–ª—É

4. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏:**
   - –ò—â–∏—Ç–µ –æ—à–∏–±–∫–∏ –≤ –ª–æ–≥–∞—Ö –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞
   - –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ –≤—Å–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è –ª–æ–≥–∏—Ä—É—é—Ç—Å—è
